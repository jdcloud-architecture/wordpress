京东云和阿里云云主机性能测试对比

# 1 摘要
本文对京东云和阿里云2核vCPU, 8GB内存云主机的性能进行测试。本测试过程采用geekbench、sysbench和fio等工具，在测试云主机基本的单核和多核计算、内存访问、云硬盘IO处理能力的基础上，进一步测试在云主机上运行MySQL的处理能力。由于公有云多租户共享资源池和虚拟化CPU超分率的不同，以及本测试云主机所运行的物理机实际负载的不确定性，本文的测试结果仅做参考。但是，大家无妨亲测一下阿里云采用Intel Skylake Xeon Platinum 8163 2.5GHz定制芯片的第5代云主机、云硬盘(SSD云盘)的整体性能。本人感悟，不测不知道，一测吓一跳。

由于本文较长，故先附上测试结果。京东云云主机测试时间是：Nov 6 16:49:00 CST 2018，阿里云云服务器测试时间是：Nov 6 23:12:12 CST 2018。整个测试过程可参考后续章节。
性能指标|京东云<b>g.n2.large</b>|阿里云<b>ecs.g5.large</b>|测试脚本
:---|:---|:---|:---
CPU单核计算能力|1086.47 次/秒|906.34 次/秒|sysbench cpu run --threads=1 --time=60
CPU多核计算能力|2182.10 次/秒|1561.76 次/秒|sysbench cpu run --threads=2 --time=60
内存随机写速度|679886.41 次/秒|1580216.42 次/秒|sysbench memory --memory-oper=write --memory-block-size=1K  --memory-access-mode=rnd --memory-scope=global --memory-total-size=100G --threads=4  --time=20 run
内存随机写吞吐量|663.95 MiB/秒|1543.18 MiB/秒|同上
内存随机读速度|2782904.63 次/秒|1592777.41 次/秒|sysbench memory --memory-oper=read --memory-block-size=1K  --memory-access-mode=rnd --memory-scope=global --memory-total-size=100G --threads=4  --time=20 run
内存随机读吞吐量|2717.68 MiB/秒|1555.45 MiB/秒|同上
FIO随机读IOPS|19400 次/秒|2414 次/秒|fio --directory=/mnt/vdb1 --name fio_test_file  --rw=randrw --direct=1  --bs=4k --size=1G --numjobs=16 --time_based --runtime=60 --group_reporting
FIO随机读吞吐量|75.6 MiB/秒|9658 KiB/秒|同上
FIO随机写IOPS|19400 次/秒|2424 次/秒|同上
FIO随机写吞吐量|75.7MiB/秒|9698KiB/秒|同上
Geekbench单核得分|3829|3479|./geekbench4 
Geekbench多核得分|7254|4138|同上 
MySQL每秒交易数|567.46 次/秒|81.37 次/秒|sysbench /usr/share/sysbench/oltp_read_write.lua prepare --tables=20  --table_size=1000000 --db-driver=mysql --mysql-password=Passw0rd@123 --mysql-host=localhost<br>sysbench /usr/share/sysbench/oltp_read_write.lua run --tables=20  --table_size=1000000 --db-driver=mysql --mysql-password=Passw0rd@123 --mysql-host=localhost --threads=400 --time=100 
MySQL每秒查询数|11353.55 次/秒|1627.63 次/秒|同上
# 2 测试环境
## 2.1 云服务器环境
本测试采用京东云的g.n2.large规格云主机和阿里云ecs.g5.large规格ECS云主机，具体配置信息如下表。

云服务商 | 云主机规格 | vCPU | 内存 | SSD云硬盘(GB)| 区域 | 可用区
:---|:---|:---|:---|:---|:---|:---
京东云 | g.n2.large | 2 | 8 | 100 | 华北-北京 | 可用区A
阿里云 | ecs.g5.large | 2 | 8 | 100 | 华北1-青岛 | 华北1-可用区C

在创建上述规格的云主机时选择"CentOS 7.4 64位"镜像，在启动云服务后，执行如下命令完成yum源更新
 ```
[root@srv013 ~]# yum upgrade -y
```
yum源更新的同时会自动更新操作系统内核到CentOS 7.5。本测试环境的操作系统将基于CentOS.
```
[root@srv013 ~]# cat /etc/redhat-release 
CentOS Linux release 7.5.1804 (Core) 
```
## 2.2 公有网络
为了能通过Internet下载测试工具Geekbench，并能把测试结果上传到Geekbench，云服务器需要绑定公网IP。

## 2.3 云硬盘
由于云主机将安装MySQL提供数据库服务，因此采用IOPS更高的SSD云盘。京东云云硬盘的使用指南请参考[https://docs.jdcloud.com/cn/cloud-disk-service/linux-partition](https://docs.jdcloud.com/cn/cloud-disk-service/linux-partition)。
执行fdisk -l命令可获得云主机上挂载的硬盘设备，其中/dev/vda是系统盘，/dev/vdb是挂载的数据盘；执行df命令能获得云主机的文件系统信息，其中/dev/vdb1就是创建在云硬盘上的文件系统。
```
[root@srv013 ~]# fdisk -l

Disk /dev/vda: 42.9 GB, 42949672960 bytes, 83886080 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x000a5a8a

   Device Boot      Start         End      Blocks   Id  System
/dev/vda1   *        2048    83886079    41942016   83  Linux

Disk /dev/vdb: 107.4 GB, 107374182400 bytes, 209715200 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x8fa72139

   Device Boot      Start         End      Blocks   Id  System
/dev/vdb1            2048   209715199   104856576   83  Linux

[root@srv013 ~]# df -m
Filesystem     1M-blocks  Used Available Use% Mounted on
/dev/vda1          40949  2007     38943   5% /
devtmpfs            3902     0      3902   0% /dev
tmpfs               3912     1      3912   1% /dev/shm
tmpfs               3912     9      3903   1% /run
tmpfs               3912     0      3912   0% /sys/fs/cgroup
/dev/vdb1         100664    61     95468   1% /mnt/vdb1
```
## 2.4 准备MySQL数据库环境
本测试除了测试云主机的基本性能指标外，还通过测试运行在云主机上的MySQL的处理能力来评估云主机的性能。通过如下步骤安装MySQL。
1. 下载MySQL安装包Yum源配置
   ```
   wget http://repo.mysql.com/mysql57-community-release-el7.rpm
   ```
2. 配置MySQL yum源
   ```
   [root@srv013 ~]# rpm -ivh mysql57-community-release-el7.rpm
   ```
3. 安装MySQL服务器
   ```
   [root@srv013 ~]# yum install -y mysql-server
   ```
4. 修改MySQL缺省数据文件目录
   MySQL缺省的数据目录位于/var/lib/mysql，为了有更大的数据存储空间，创建MySQL数据目录。并分配权限。
   ```
   mkdir -p /var/lib/mysql
   chown -R mysql:mysql /var/lib/mysql
   ```
   将MySQL数据存储在数盘的特定目录下(假设为/mnt/vdb1/mysql)。修改/etc/my.cnf
   ```
   datadir=/mnt/vdb1/mysql
   ```
5. 配置并启动MySQL服务
   ```
   [root@srv013 ~]# chkconfig mysqld on
   Note: Forwarding request to 'systemctl enable mysqld.service'.
   [root@srv013 ~]# service mysqld restart
   Redirecting to /bin/systemctl restart mysqld.service
   ```
6. 重置MySQL缺省口令。首先查看MySQL安装时生成的缺省口令，然后登录MySQL设置口令。
   ```
   [root@srv013 ~]# grep "temporary password" /var/log/mysqld.log 
   2018-11-06T03:01:40.331842Z 1 [Note] A temporary password is generated for root@localhost: ftmgLQl;r0qh

   mysql> set password=password('Passw0rd@123');

# 3 测试工具
为了对云主机进行全面、准确的性能测试，本测试将采用如下测试工具。
软件|版本|描述
:---|:---|:---
sysbench|1.0.9|操作系统和MySQL等数据库性能评测工具
fio|3.1|磁盘IO性能评测工具
Geekbench|Geekbench 4.3.0 Tryout Build 401258|通过模拟真实的计算任务和应用场景来评测性能

## 3.1 安装sysbench
执行yum intall sysbench，安装sysbench。
```
[root@srv013 ~]# yum install -y sysbench
[root@srv013 ~]# sysbench --version
sysbench 1.0.9
```
## 3.2 安装fio
执行yum install fio，安装fio。
```
[root@srv013 ~]# yum install -y fio
[root@srv013 ~]# fio --version
fio-3.1
```
## 3.3 安装Geekbench
执行如下命令下载Geekbench安装包，然后解压缩。
```
[root@srv013 ~]# wget http://cdn.geekbench.com/Geekbench-4.3.0-Linux.tar.gz
[root@srv013 ~]# tar zxvf Geekbench-4.3.0-Linux.tar.gz 
[root@srv013 ~]# Geekbench-4.3.0-Linux/geekbench4 --version
Geekbench 4.3.0 Tryout Build 401258 (hogtown-master-build bdacbd1212)
 ```
# 3 测试方法
本节介绍对云主机进行全面性能测试的测试方法。
## 3.1 CPU性能测试
CPU性能测试关注CPU在单核和多核情况下的处理能力，本问采用sysbench来测试。

测试用例|测试目的|测试指标|测试描述|测试命令
:---|:---|:---|:---|:---
CPU单核计算能力|测试云主机单核计算能力|每秒计算次数|采用一个线程，在60秒内循环计算不超过10000的最大素数|sysbench cpu run --threads=1 --time=60
CPU多核计算能力|测试云主机多核计算能力|每秒计算次数|采用两个线程，在60秒内循环计算不超过10000的最大素数|sysbench cpu run --threads=2 --time=60
以京东云主机为例，该云主机单核每秒能完成10000的最大素数计算**1105.77次**，  两核每秒能完成10000的最大素数计算**2190.83次**。由于本云主机只有2个vCPU，因此增加threads的值对处理能力的影响不大。
```
[root@srv013 ~]# sysbench cpu run --threads=1 --time=60
sysbench 1.0.9 (using system LuaJIT 2.0.4)

Running the test with following options:
Number of threads: 1
Initializing random number generator from current time


Prime numbers limit: 10000

Initializing worker threads...

Threads started!

CPU speed:
    events per second:  1105.77

General statistics:
    total time:                          60.0008s
    total number of events:              66349

Latency (ms):
         min:                                  0.85
         avg:                                  0.90
         max:                                  1.11
         95th percentile:                      0.97
         sum:                              59982.46

Threads fairness:
    events (avg/stddev):           66349.0000/0.00
    execution time (avg/stddev):   59.9825/0.00

[root@srv013 ~]# sysbench cpu run --threads=2 --time=60
sysbench 1.0.9 (using system LuaJIT 2.0.4)

Running the test with following options:
Number of threads: 2
Initializing random number generator from current time


Prime numbers limit: 10000

Initializing worker threads...

Threads started!

CPU speed:
    events per second:  2190.83

General statistics:
    total time:                          60.0007s
    total number of events:              131455

Latency (ms):
         min:                                  0.86
         avg:                                  0.91
         max:                                  4.66
         95th percentile:                      0.97
         sum:                             119940.13

Threads fairness:
    events (avg/stddev):           65727.5000/45.50
    execution time (avg/stddev):   59.9701/0.00
 ```
 ## 3.2 内存测试
云主机内存测试主要测基于特定大小内存操作块，每秒进行内存操作的次数和内存访问吞吐量。比如下一命令表示的测试场景是：
* --memory-oper=write：进行内存写操作
* --memory-block-size=1K：每次写1024个字节
* --memory-access-mode=rnd：采用随机方式访问内存
* --memory-total-size=100G：往内存写的总数据量
* --threads=4：启动4个线程进行内存写操作，通常改值是云主机CPU的vCPU个数
* --time=20：执行20秒后终止，或者内存写数据量达到memory-total-size
基于内存测试的结果可获得
* 云主机的内存随机写速度 = 282123.55次/秒
* 云主机的内存随机写吞吐量 = 275.51 MiB/秒
 ```
[root@srv013 ~]# sysbench memory --memory-oper=write --memory-block-size=1K  --memory-access-mode=rnd --memory-scope=global --memory-total-size=100G --threads=4  --time=20 run
sysbench 1.0.9 (using system LuaJIT 2.0.4)

Running the test with following options:
Number of threads: 4
Initializing random number generator from current time


Running memory speed test with the following options:
  block size: 1KiB
  total size: 102400MiB
  operation: write
  scope: global

Initializing worker threads...

Threads started!

Total operations: 5642904 (282123.55 per second)

5510.65 MiB transferred (275.51 MiB/sec)


General statistics:
    total time:                          20.0001s
    total number of events:              5642904

Latency (ms):
         min:                                  0.00
         avg:                                  0.01
         max:                                 33.43
         95th percentile:                      0.01
         sum:                              76900.75

Threads fairness:
    events (avg/stddev):           1410726.0000/406129.54
    execution time (avg/stddev):   19.2252/0.16
```
## 3.3 磁盘IO测试
对于数据盘，可通过FIO或者sysbench测试磁盘性能。下述fio命令所表示对测试用例是：
* --directory=/mnt/vdb1：对/mnt/vdb1目录下的IO能力进行测试。/mnt/vdb1位于云主机挂载的SSD云硬盘。
* --name fio_test_file: 测试任务名字
* --rw=randrw：进行随机读和写
* --direct=1：不采用IO缓存，直接从磁盘读写
* --bs=4k：每次读写4K字节
* --size=1G：每个测试任务处理的文件大小是1G
* --numjobs=16：测试任务数为16个
* --time_based：测试任务运行固定时长，如果测试文件已经完成读写，仍然从头继续执行
* --runtime=60：执行时长60秒
* --group_reporting：汇总所有测试任务的结果
```
[root@srv013 ~]# fio --directory=/mnt/vdb1 --name fio_test_file  --rw=randrw --direct=1  --bs=4k --size=1G --numjobs=16 --time_based --runtime=60 --group_reporting
fio_test_file: (g=0): rw=randrw, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=psync, iodepth=1
...
fio-3.1
Starting 16 processes
Jobs: 16 (f=16): [m(16)][100.0%][r=65.9MiB/s,w=65.7MiB/s][r=16.9k,w=16.8k IOPS][eta 00m:00s]
fio_test_file: (groupid=0, jobs=16): err= 0: pid=19617: Tue Nov  6 14:11:26 2018
   read: IOPS=19.5k, BW=76.1MiB/s (79.8MB/s)(4567MiB/60003msec)
    clat (nsec): min=681, max=201347k, avg=102722.43, stdev=423061.55
     lat (nsec): min=818, max=201347k, avg=102909.92, stdev=423063.68
```
从上述命令的输出可获得，在采用4K数据块时，该云硬盘的性能测试结果是：
* 随机读IOPS: 16900次/秒
* 随机写IOPS：16800次/秒
* 随机读吞吐量: 65.9MiB/秒
* 随机写吞吐量: 65.7MiB/秒

也可以用sysbench测试云硬盘性能。首先进入云硬盘所对应的目录（比如/mnt/vdb1），执行如下命令准备测试数据，该测试数据有16个1G大小的文件组成，在完成文件初始化后，能看到磁盘的写吞吐量为96.48 MiB/sec。
```
[root@srv013 vdb1]# pwd
/mnt/vdb1
[root@srv013 vdb1]# sysbench fileio --file-total-size=16G --file-num=16 prepare
sysbench 1.0.9 (using system LuaJIT 2.0.4)

16 files, 1048576Kb each, 16384Mb total
Creating files for the test...
Extra file open flags: 0
Creating file test_file.0
...
Creating file test_file.15
17179869184 bytes written in 169.82 seconds (96.48 MiB/sec).
```
然后执行如下命令测试磁盘IO。从sysbench测试结果可得到如下云硬盘性能信息。因此，通过fio和sysbench测试所获得云硬盘差距不大。
* 随机写IOPS(writes/s)：19537.74次/秒
* 随机写吞吐量(written, MiB/s): 76.32MiB/秒

```
[root@srv013 vdb1]# sysbench fileio --file-total-size=16G --file-num=16 --file-test-mode=rndwr --file-block-size=4096 run --time=60  --threads=16
sysbench 1.0.9 (using system LuaJIT 2.0.4)

Running the test with following options:
Number of threads: 16
Initializing random number generator from current time


Extra file open flags: 0
16 files, 1GiB each
16GiB total file size
Block size 4KiB
Number of IO requests: 0
Read/Write ratio for combined random IO test: 1.50
Periodic FSYNC enabled, calling fsync() each 100 requests.
Calling fsync() at the end of test, Enabled.
Using synchronous I/O mode
Doing random write test
Initializing worker threads...

Threads started!


File operations:
    reads/s:                      0.00
    writes/s:                     19537.74
    fsyncs/s:                     3125.79

Throughput:
    read, MiB/s:                  0.00
    written, MiB/s:               76.32

General statistics:
    total time:                          60.0260s
    total number of events:              1360433

Latency (ms):
         min:                                  0.00
         avg:                                  0.71
         max:                                219.77
         95th percentile:                      5.09
         sum:                             959686.60

Threads fairness:
    events (avg/stddev):           85027.0625/16690.02
    execution time (avg/stddev):   59.9804/0.01
```
## 3.4 云主机整体性能评估
Geekbench通过模拟各种任务和应用来评估服务整体性能。首先通过运行geekbench4 --sysinfo能获得云主机信息。下面是京东云云主机的系统信息。
 ```
 [root@srv013 Geekbench-4.3.0-Linux]# ./geekbench4 --sysinfo
Geekbench 4.3.0 Tryout : http://www.geekbench.com/

Geekbench 4 is in tryout mode.

System Information
  Operating System              Linux 3.10.0-693.el7.x86_64 x86_64
  Model                         JD JCloud Iaas Jvirt
  Motherboard                   N/A
  Memory                        7.64 GB 
  BIOS                          SeaBIOS 1.10.2-1.el7

Processor Information
  Name                          Intel Xeon Gold 6148
  Topology                      1 Processor, 1 Core, 2 Threads
  Identifier                    GenuineIntel Family 6 Model 85 Stepping 4
  Base Frequency                2.39 GHz
  L1 Instruction Cache          32.0 KB x 2
  L1 Data Cache                 32.0 KB x 2
  L2 Cache                      4.00 MB
  L3 Cache                      16.0 MB
```
如果没有购买Geekbench的License，Geekbench的测试结果需要上传到Geekbench网站，然后通过浏览器查看结果。
```
[root@srv013 Geekbench-4.3.0-Linux]# ./geekbench4 

...
Upload succeeded. Visit the following link and view your results online:

  https://browser.geekbench.com/v4/cpu/10663150

Visit the following link and add this result to your profile:

  https://browser.geekbench.com/v4/cpu/10663150/claim?key=729158
```
访问测试结果地址[https://browser.geekbench.com/v4/cpu/10663150](https://browser.geekbench.com/v4/cpu/10663150), 将获得如下云主机性能得分信息。Geekbench的得分有比较负责的模型，详细信息参考[https://www.geekbench.com/doc/geekbench4-cpu-workloads.pdf](https://www.geekbench.com/doc/geekbench4-cpu-workloads.pdf)。

Single-Core Score |	Multi-Core Score
:---|:---
3839|7075

## 3.5 MySQL性能
在对云主机的CPU、内存、磁盘等单项指标进行测试后，将对运行在该云主机上的MySQL进行性能评估。下面首先初始化用户测试的MySQL账户信息。
```
mysql> create database sbtest;
Query OK, 1 row affected (0.00 sec)

mysql> create user 'sbtest'@'%' identified by 'Passw0rd@123';
Query OK, 0 rows affected (0.00 sec)

mysql> grant all on *.* to 'sbtest'@'%' identified by 'Passw0rd@123';
Query OK, 0 rows affected, 1 warning (0.00 sec)
```
验证测试用户sbtest能正常访问MySQL。
```
[root@srv013 etc]# mysql -usbtest -p -hlocalhost
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 9
Server version: 5.7.24 MySQL Community Server (GPL)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
```
下面测试通过sysbench测试MySQL的OLTP处理能力。/usr/share/sysbench/oltp_read_write.lua是sysbench自带的测试用例。
```
root@srv013 etc]# sysbench /usr/share/sysbench/oltp_read_write.lua  help
sysbench 1.0.9 (using system LuaJIT 2.0.4)

oltp_read_write.lua options:
  --distinct_ranges=N           Number of SELECT DISTINCT queries per transaction [1]
  --sum_ranges=N                Number of SELECT SUM() queries per transaction [1]
  --skip_trx[=on|off]           Don't start explicit transactions and execute all queries in the AUTOCOMMIT mode [off]
  --secondary[=on|off]          Use a secondary index in place of the PRIMARY KEY [off]
  --create_secondary[=on|off]   Create a secondary index in addition to the PRIMARY KEY [on]
  --index_updates=N             Number of UPDATE index queries per transaction [1]
  --range_size=N                Range size for range SELECT queries [100]
  --auto_inc[=on|off]           Use AUTO_INCREMENT column as Primary Key (for MySQL), or its alternatives in other DBMS. When disabled, use client-generated IDs [on]
  --delete_inserts=N            Number of DELETE/INSERT combination per transaction [1]
  --tables=N                    Number of tables [1]
  --mysql_storage_engine=STRING Storage engine, if MySQL is used [innodb]
  --non_index_updates=N         Number of UPDATE non-index queries per transaction [1]
  --table_size=N                Number of rows per table [10000]
  --pgsql_variant=STRING        Use this PostgreSQL variant when running with the PostgreSQL driver. The only currently supported variant is 'redshift'. When enabled, create_secondary is automatically disabled, and delete_inserts is set to 0
  --simple_ranges=N             Number of simple range SELECT queries per transaction [1]
  --order_ranges=N              Number of SELECT ORDER BY queries per transaction [1]
  --range_selects[=on|off]      Enable/disable all range SELECT queries [on]
  --point_selects=N             Number of point SELECT queries per transaction [10]
```
通过运行如下命令能获得利用sysbench测试MySQL时特有的选项。
```
[root@srv013 etc]# sysbench --help
Usage:
  sysbench [options]... [testname] [command]
...
mysql options:
  --mysql-host=[LIST,...]          MySQL server host [localhost]
  --mysql-port=[LIST,...]          MySQL server port [3306]
  --mysql-socket=[LIST,...]        MySQL socket
  --mysql-user=STRING              MySQL user [sbtest]
  --mysql-password=STRING          MySQL password []
  --mysql-db=STRING                MySQL database name [sbtest]
  --mysql-ssl[=on|off]             use SSL connections, if available in the client library [off]
  --mysql-ssl-cipher=STRING        use specific cipher for SSL connections []
  --mysql-compression[=on|off]     use compression, if available in the client library [off]
  --mysql-debug[=on|off]           trace all client library calls [off]
  --mysql-ignore-errors=[LIST,...] list of errors to ignore, or "all" [1213,1020,1205]
  --mysql-dry-run[=on|off]         Dry run, pretend that all MySQL client API calls are successful without executing them [off]
```
执行如下命令，初始化20张表，每张表有100万条数据。
```
sysbench /usr/share/sysbench/oltp_read_write.lua prepare --tables=20  --table_size=1000000 --db-driver=mysql --mysql-password=Passw0rd@123 --mysql-host=localhost
```
查看MySQL缺省最大连接数量为151，设置max_connections连接数为500，此外设置ax_prepared_stmt_count为131072，避免数据库连接增多并执行SQL时报错。
```
mysql> show global variables like "%connection%";
+:---:---:---:---:---:---:---:-----+:---:---:---:---:---:----+
| Variable_name            | Value             |
+:---:---:---:---:---:---:---:-----+:---:---:---:---:---:----+
| character_set_connection | latin1            |
| collation_connection     | latin1_swedish_ci |
| max_connections          | 151               |
| max_user_connections     | 0                 |
+:---:---:---:---:---:---:---:-----+:---:---:---:---:---:----+
4 rows in set (0.00 sec)
mysql> set global max_connections=500;
mysql> set global max_prepared_stmt_count=131072;
```
执行如下命令，模拟400个MySQL客户端访问，执行100秒。
```
[root@srv013 etc]# sysbench /usr/share/sysbench/oltp_read_write.lua run --tables=20  --table_size=1000000 --db-driver=mysql --mysql-password=Passw0rd@123 --mysql-host=localhost --threads=400 --time=100 
```
在执行过程中，通过查看MySQL连接信息，能看到正在执行的SQL语句。
```
mysql> show full processlist;
+:---:---+:---:-----+:---:---:-----+:---:-----+:---:---:---+:---:---+:---:---:---:---+:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---+
| Id   | User   | Host      | db     | Command | Time | State      | Info                                                                |
+:---:---+:---:-----+:---:---:-----+:---:-----+:---:---:---+:---:---+:---:---:---:---+:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---:---+
| 2138 | root   | localhost | NULL   | Query   |    0 | starting   | show full processlist                                               |
| 2139 | sbtest | localhost | sbtest | Execute |    0 | statistics | SELECT c FROM sbtest5 WHERE id BETWEEN ? AND ? ORDER BY c           |
| 2140 | sbtest | localhost | sbtest | Execute |    0 | statistics | SELECT c FROM sbtest13 WHERE id=?                                   |
| 2141 | sbtest | localhost | sbtest | Execute |    0 | update     | INSERT INTO sbtest7 (id, k, c, pad) VALUES (?, ?, ?, ?)             |
| 2142 | sbtest | localhost | sbtest | Execute |    0 | statistics | SELECT DISTINCT c FROM sbtest2 WHERE id BETWEEN ? AND ? ORDER BY c  |
| 2143 | sbtest | localhost | sbtest | Execute |    0 | updating   | UPDATE sbtest5 SET k=k+1 WHERE id=?                                 |
```
在执行完成后，将看到如下性能信息：
* 每秒交易数(transactions)：629.08次/秒
* 每秒查询数(queries): 12586.52次/秒
```
[root@srv013 etc]# sysbench /usr/share/sysbench/oltp_read_write.lua run --tables=20  --table_size=1000000 --db-driver=mysql --mysql-password=Passw0rd@123 --mysql-host=localhost --threads=400 --time=100 
sysbench 1.0.9 (using system LuaJIT 2.0.4)

Running the test with following options:
Number of threads: 400
Initializing random number generator from current time

Initializing worker threads...

Threads started!

SQL statistics:
    queries performed:
        read:                            885892
        write:                           253019
        other:                           126525
        total:                           1265436
    transactions:                        63247  (629.08 per sec.)
    queries:                             1265436 (12586.52 per sec.)
    ignored errors:                      31     (0.31 per sec.)
    reconnects:                          0      (0.00 per sec.)

General statistics:
    total time:                          100.5374s
    total number of events:              63247

Latency (ms):
         min:                                  3.19
         avg:                                633.89
         max:                               5763.33
         95th percentile:                   1427.08
         sum:                            40091826.77

Threads fairness:
    events (avg/stddev):           158.1175/7.94
    execution time (avg/stddev):   100.2296/0.13
```
# 4 京东云云主机和阿里云云主机对比测试结果
## 4.1 京东云云主机信息
```
[root@srv013 Geekbench-4.3.0-Linux]# ./geekbench4 --sysinfo
...
System Information
  Operating System              Linux 3.10.0-693.el7.x86_64 x86_64
  Model                         JD JCloud Iaas Jvirt
  Motherboard                   N/A
  Memory                        7.64 GB 
  BIOS                          SeaBIOS 1.10.2-1.el7

Processor Information
  Name                          Intel Xeon Gold 6148
  Topology                      1 Processor, 1 Core, 2 Threads
  Identifier                    GenuineIntel Family 6 Model 85 Stepping 4
  Base Frequency                2.39 GHz
  L1 Instruction Cache          32.0 KB x 2
  L1 Data Cache                 32.0 KB x 2
  L2 Cache                      4.00 MB
  L3 Cache                      16.0 MB

[root@srv013 Geekbench-4.3.0-Linux]# df -m
Filesystem     1M-blocks  Used Available Use% Mounted on
/dev/vda1          40949 29787     11163  73% /
devtmpfs            3902     0      3902   0% /dev
tmpfs               3912     1      3912   1% /dev/shm
tmpfs               3912     9      3903   1% /run
tmpfs               3912     0      3912   0% /sys/fs/cgroup
/dev/vdb1         100664 38252     57277  41% /mnt/vdb1
tmpfs                783     0       783   0% /run/user/0
```
## 4.2 阿里云云主机信息
```
[root@izm5ead1jbc6fuk9xb9j4nz Geekbench-4.3.0-Linux]# ./geekbench4 --sysinfo
...
System Information
  Operating System              Linux 3.10.0-693.2.2.el7.x86_64 x86_64
  Model                         Alibaba Cloud Alibaba Cloud ECS
  Motherboard                   N/A
  Memory                        7.64 GB 
  BIOS                          SeaBIOS 
rel-1.7.5-0-ge51488c-20140602_164612-nilsson.home.kraxel.org

Processor Information
  Name                          Intel(R) Xeon(R) Platinum 8163 CPU @ 2.50GHz
  Topology                      1 Processor, 1 Core, 2 Threads
  Identifier                    GenuineIntel Family 6 Model 85 Stepping 4
  Base Frequency                2.50 GHz
  L1 Instruction Cache          32.0 KB
  L1 Data Cache                 32.0 KB
  L2 Cache                      1.00 MB
  L3 Cache                      33.0 MB

[root@izm5ead1jbc6fuk9xb9j4nz Geekbench-4.3.0-Linux]# df -m
Filesystem     1M-blocks  Used Available Use% Mounted on
/dev/vda1          40188  1955     36169   6% /
devtmpfs            3903     0      3903   0% /dev
tmpfs               3912     0      3912   0% /dev/shm
tmpfs               3912     1      3912   1% /run
tmpfs               3912     0      3912   0% /sys/fs/cgroup
tmpfs                783     0       783   0% /run/user/0
/dev/vdb1         100664    61     95468   1% /mnt/vdb1

```
## 4.3 对比测试结果
本节将基于前面介绍测试方法，分别在京东云云主机和阿里云云服务器ECS上的测试结果。京东云云主机测试时间是：Nov  6 16:49:00 CST 2018，阿里云云服务器测试时间是：Nov  6 23:12:12 CST 2018。

性能指标|京东云<b>g.n2.large</b>|阿里云<b>ecs.g5.large</b>|测试脚本
:---|:---|:---|:---
CPU单核计算能力|1086.47 次/秒|906.34 次/秒|sysbench cpu run --threads=1 --time=60
CPU多核计算能力|2182.10 次/秒|1561.76 次/秒|sysbench cpu run --threads=2 --time=60
内存随机写速度|679886.41 次/秒|1580216.42 次/秒|sysbench memory --memory-oper=write --memory-block-size=1K  --memory-access-mode=rnd --memory-scope=global --memory-total-size=100G --threads=4  --time=20 run
内存随机写吞吐量|663.95 MiB/秒|1543.18 MiB/秒|同上
内存随机读速度|2782904.63 次/秒|1592777.41 次/秒|sysbench memory --memory-oper=read --memory-block-size=1K  --memory-access-mode=rnd --memory-scope=global --memory-total-size=100G --threads=4  --time=20 run
内存随机读吞吐量|2717.68 MiB/秒|1555.45 MiB/秒|同上
FIO随机读IOPS|19400 次/秒|2414 次/秒|fio --directory=/mnt/vdb1 --name fio_test_file  --rw=randrw --direct=1  --bs=4k --size=1G --numjobs=16 --time_based --runtime=60 --group_reporting
FIO随机读吞吐量|75.6 MiB/秒|9658 KiB/秒|同上
FIO随机写IOPS|19400 次/秒|2424 次/秒|同上
FIO随机写吞吐量|75.7MiB/秒|9698KiB/秒|同上
Geekbench单核得分|3829|3479|./geekbench4 
Geekbench多核得分|7254|4138|同上 
MySQL每秒交易数|567.46 次/秒|81.37 次/秒|sysbench /usr/share/sysbench/oltp_read_write.lua prepare --tables=20  --table_size=1000000 --db-driver=mysql --mysql-password=Passw0rd@123 --mysql-host=localhost<br>sysbench /usr/share/sysbench/oltp_read_write.lua run --tables=20  --table_size=1000000 --db-driver=mysql --mysql-password=Passw0rd@123 --mysql-host=localhost --threads=400 --time=100 
MySQL每秒查询数|11353.55 次/秒|1627.63 次/秒|同上
# 5 附录
## 5.1 京东云主机测试日志
```
[root@srv013 etc]# date
Tue Nov  6 16:49:00 CST 2018
[root@srv013 ~]# sysbench cpu run --threads=1 --time=60
sysbench 1.0.9 (using system LuaJIT 2.0.4)

Running the test with following options:
Number of threads: 1
Initializing random number generator from current time


Prime numbers limit: 10000

Initializing worker threads...

Threads started!

CPU speed:
    events per second:  1086.47

General statistics:
    total time:                          60.0010s
    total number of events:              65191

Latency (ms):
         min:                                  0.85
         avg:                                  0.92
         max:                                  1.12
         95th percentile:                      0.97
         sum:                              59982.91

Threads fairness:
    events (avg/stddev):           65191.0000/0.00
    execution time (avg/stddev):   59.9829/0.00
[root@srv013 ~]# sysbench cpu run --threads=2 --time=60
sysbench 1.0.9 (using system LuaJIT 2.0.4)

Running the test with following options:
Number of threads: 2
Initializing random number generator from current time


Prime numbers limit: 10000

Initializing worker threads...

Threads started!

CPU speed:
    events per second:  2182.10

General statistics:
    total time:                          60.0008s
    total number of events:              130931

Latency (ms):
         min:                                  0.87
         avg:                                  0.92
         max:                                  7.03
         95th percentile:                      0.97
         sum:                             119916.09

Threads fairness:
    events (avg/stddev):           65465.5000/41.50
    execution time (avg/stddev):   59.9580/0.00
[root@srv013 ~]# sysbench memory --memory-oper=write --memory-block-size=1K --memory-access-mode=rnd --memory-scope=global --memory-total-size=100G --threads=4 --time=20 run
sysbench 1.0.9 (using system LuaJIT 2.0.4)

Running the test with following options:
Number of threads: 4
Initializing random number generator from current time


Running memory speed test with the following options:
  block size: 1KiB
  total size: 102400MiB
  operation: write
  scope: global

Initializing worker threads...

Threads started!

Total operations: 13598740 (679886.41 per second)

13280.02 MiB transferred (663.95 MiB/sec)


General statistics:
    total time:                          20.0001s
    total number of events:              13598740

Latency (ms):
         min:                                  0.00
         avg:                                  0.01
         max:                                 38.01
         95th percentile:                      0.00
         sum:                              73399.91

Threads fairness:
    events (avg/stddev):           3399685.0000/34807.99
    execution time (avg/stddev):   18.3500/0.10

[root@srv013 ~]# sysbench memory --memory-oper=read --memory-block-size=1K --memory-access-mode=rnd --memory-scope=global --memory-total-size=100G --threads=4 --time=20 run
sysbench 1.0.9 (using system LuaJIT 2.0.4)

Running the test with following options:
Number of threads: 4
Initializing random number generator from current time


Running memory speed test with the following options:
  block size: 1KiB
  total size: 102400MiB
  operation: read
  scope: global

Initializing worker threads...

Threads started!

Total operations: 55662182 (2782904.63 per second)

54357.60 MiB transferred (2717.68 MiB/sec)


General statistics:
    total time:                          20.0001s
    total number of events:              55662182

Latency (ms):
         min:                                  0.00
         avg:                                  0.00
         max:                                 42.01
         95th percentile:                      0.00
         sum:                              54454.60

Threads fairness:
    events (avg/stddev):           13915545.5000/131456.52
    execution time (avg/stddev):   13.6136/0.10

[root@srv013 ~]# fio --directory=/mnt/vdb1 --name fio_test_file --rw=randrw --direct=1 --bs=4k --size=1G --numjobs=16 --time_based --runtime=60 --group_reporting
fio_test_file: (g=0): rw=randrw, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=psync, iodepth=1
...
fio-3.1
Starting 16 processes
Jobs: 16 (f=16): [m(16)][100.0%][r=77.7MiB/s,w=78.2MiB/s][r=19.9k,w=20.0k IOPS][eta 00m:00s]
fio_test_file: (groupid=0, jobs=16): err= 0: pid=31818: Tue Nov  6 16:57:05 2018
   read: IOPS=19.4k, BW=75.6MiB/s (79.3MB/s)(4539MiB/60008msec)
    clat (nsec): min=731, max=212069k, avg=108319.32, stdev=572866.78
     lat (nsec): min=876, max=212069k, avg=108521.16, stdev=572869.13
    clat percentiles (nsec):
     |  1.00th=[   1448],  5.00th=[   1784], 10.00th=[   2008],
     | 20.00th=[   2352], 30.00th=[   2800], 40.00th=[   3472],
     | 50.00th=[   4016], 60.00th=[   4832], 70.00th=[ 230400],
     | 80.00th=[ 272384], 90.00th=[ 317440], 95.00th=[ 354304],
     | 99.00th=[ 477184], 99.50th=[ 626688], 99.90th=[1056768],
     | 99.95th=[1794048], 99.99th=[9764864]
   bw (  KiB/s): min= 2248, max= 7856, per=6.26%, avg=4846.72, stdev=465.64, samples=1920
   iops        : min=  562, max= 1964, avg=1211.53, stdev=116.37, samples=1920
  write: IOPS=19.4k, BW=75.7MiB/s (79.4MB/s)(4543MiB/60008msec)
    clat (usec): min=309, max=199306, avg=714.53, stdev=485.59
     lat (usec): min=310, max=199306, avg=714.85, stdev=485.59
    clat percentiles (usec):
     |  1.00th=[  429],  5.00th=[  469], 10.00th=[  498], 20.00th=[  545],
     | 30.00th=[  603], 40.00th=[  676], 50.00th=[  725], 60.00th=[  758],
     | 70.00th=[  799], 80.00th=[  832], 90.00th=[  889], 95.00th=[  947],
     | 99.00th=[ 1090], 99.50th=[ 1205], 99.90th=[ 2704], 99.95th=[ 4490],
     | 99.99th=[12125]
   bw (  KiB/s): min= 2108, max= 7640, per=6.26%, avg=4850.11, stdev=393.90, samples=1920
   iops        : min=  527, max= 1910, avg=1212.37, stdev=98.46, samples=1920
  lat (nsec)   : 750=0.01%, 1000=0.03%
  lat (usec)   : 2=4.92%, 4=19.83%, 10=8.03%, 20=0.22%, 50=0.01%
  lat (usec)   : 250=4.06%, 500=17.49%, 750=23.91%, 1000=20.17%
  lat (msec)   : 2=1.21%, 4=0.08%, 10=0.03%, 20=0.01%, 50=0.01%
  lat (msec)   : 100=0.01%, 250=0.01%
  cpu          : usr=0.43%, sys=1.91%, ctx=1567737, majf=0, minf=504
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwt: total=1162097,1162917,0, short=0,0,0, dropped=0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
   READ: bw=75.6MiB/s (79.3MB/s), 75.6MiB/s-75.6MiB/s (79.3MB/s-79.3MB/s), io=4539MiB (4760MB), run=60008-60008msec
  WRITE: bw=75.7MiB/s (79.4MB/s), 75.7MiB/s-75.7MiB/s (79.4MB/s-79.4MB/s), io=4543MiB (4763MB), run=60008-60008msec

Disk stats (read/write):
  vdb: ios=404652/1160782, merge=1/22, ticks=121449/812669, in_queue=934265, util=99.89%

[root@srv013 Geekbench-4.3.0-Linux]# ./geekbench4 
Geekbench 4.3.0 Tryout : http://www.geekbench.com/

Geekbench 4 is in tryout mode.

Geekbench 4 requires an active Internet connection when in tryout mode, and 
automatically uploads test results to the Geekbench Browser. Other features 
are unavailable in tryout mode.

Buy a Geekbench 4 license to enable offline use and remove the limitations of 
tryout mode.

If you would like to purchase Geekbench you can do so online:

  https://store.primatelabs.com/v4

If you have already purchased Geekbench, enter your email address and license 
key from your email receipt with the following command line:

  ./geekbench4 -r <email address> <license key>

  Running Gathering system information
System Information
  Operating System              Linux 3.10.0-693.el7.x86_64 x86_64
  Model                         JD JCloud Iaas Jvirt
  Motherboard                   N/A
  Memory                        7.64 GB 
  BIOS                          SeaBIOS 1.10.2-1.el7

Processor Information
  Name                          Intel Xeon Gold 6148
  Topology                      1 Processor, 1 Core, 2 Threads
  Identifier                    GenuineIntel Family 6 Model 85 Stepping 4
  Base Frequency                2.39 GHz
  L1 Instruction Cache          32.0 KB x 2
  L1 Data Cache                 32.0 KB x 2
  L2 Cache                      4.00 MB
  L3 Cache                      16.0 MB


Single-Core
  Running AES
  Running LZMA
  Running JPEG
  Running Canny
  Running Lua
  Running Dijkstra
  Running SQLite
  Running HTML5 Parse
  Running HTML5 DOM
  Running Histogram Equalization
  Running PDF Rendering
  Running LLVM
  Running Camera
  Running SGEMM
  Running SFFT
  Running N-Body Physics
  Running Ray Tracing
  Running Rigid Body Physics
  Running HDR
  Running Gaussian Blur
  Running Speech Recognition
  Running Face Detection
  Running Memory Copy
  Running Memory Latency
  Running Memory Bandwidth

Multi-Core
  Running AES
  Running LZMA
  Running JPEG
  Running Canny
  Running Lua
  Running Dijkstra
  Running SQLite
  Running HTML5 Parse
  Running HTML5 DOM
  Running Histogram Equalization
  Running PDF Rendering
  Running LLVM
  Running Camera
  Running SGEMM
  Running SFFT
  Running N-Body Physics
  Running Ray Tracing
  Running Rigid Body Physics
  Running HDR
  Running Gaussian Blur
  Running Speech Recognition
  Running Face Detection
  Running Memory Copy
  Running Memory Latency
  Running Memory Bandwidth


Uploading results to the Geekbench Browser. This could take a minute or two 
depending on the speed of your internet connection.

Upload succeeded. Visit the following link and view your results online:

  https://browser.geekbench.com/v4/cpu/10664695

Visit the following link and add this result to your profile:

  https://browser.geekbench.com/v4/cpu/10664695/claim?key=497679

[root@srv013 Geekbench-4.3.0-Linux]# sysbench /usr/share/sysbench/oltp_read_write.lua run --tables=20 --table_size=1000000 --db-driver=mysql --mysql-password=Passw0rd@123 --mysql-host=localhost --threads=400 --time=100
sysbench 1.0.9 (using system LuaJIT 2.0.4)

Running the test with following options:
Number of threads: 400
Initializing random number generator from current time


Initializing worker threads...

Threads started!

SQL statistics:
    queries performed:
        read:                            800408
        write:                           228602
        other:                           114316
        total:                           1143326
    transactions:                        57144  (567.46 per sec.)
    queries:                             1143326 (11353.55 per sec.)
    ignored errors:                      28     (0.28 per sec.)
    reconnects:                          0      (0.00 per sec.)

General statistics:
    total time:                          100.7005s
    total number of events:              57144

Latency (ms):
         min:                                  3.15
         avg:                                700.80
         max:                               8129.54
         95th percentile:                   1648.20
         sum:                            40046574.35

Threads fairness:
    events (avg/stddev):           142.8600/7.70
    execution time (avg/stddev):   100.1164/0.25
```
## 5.2 阿里云云主机测试日志
```
[root@izm5ead1jbc6fuk9xb9j4nz ~]# date
Tue Nov  6 23:12:12 CST 2018
[root@izm5ead1jbc6fuk9xb9j4nz ~]# sysbench cpu run --threads=1 --time=60
sysbench 1.0.9 (using system LuaJIT 2.0.4)

Running the test with following options:
Number of threads: 1
Initializing random number generator from current time


Prime numbers limit: 10000

Initializing worker threads...

Threads started!

CPU speed:
    events per second:   906.34

General statistics:
    total time:                          60.0009s
    total number of events:              54383

Latency (ms):
         min:                                  1.09
         avg:                                  1.10
         max:                                  1.35
         95th percentile:                      1.12
         sum:                              59978.25

Threads fairness:
    events (avg/stddev):           54383.0000/0.00
    execution time (avg/stddev):   59.9782/0.00

[root@izm5ead1jbc6fuk9xb9j4nz ~]# sysbench cpu run --threads=2 --time=60
sysbench 1.0.9 (using system LuaJIT 2.0.4)

Running the test with following options:
Number of threads: 2
Initializing random number generator from current time


Prime numbers limit: 10000

Initializing worker threads...

Threads started!

CPU speed:
    events per second:  1561.76

General statistics:
    total time:                          60.0011s
    total number of events:              93710

Latency (ms):
         min:                                  1.11
         avg:                                  1.28
         max:                                  3.23
         95th percentile:                      1.30
         sum:                             119961.51

Threads fairness:
    events (avg/stddev):           46855.0000/3.00
    execution time (avg/stddev):   59.9808/0.00

[root@izm5ead1jbc6fuk9xb9j4nz ~]# sysbench memory --memory-oper=write --memory-block-size=1K --memory-access-mode=rnd --memory-scope=global --memory-total-size=100G --threads=4 --time=20 run
sysbench 1.0.9 (using system LuaJIT 2.0.4)

Running the test with following options:
Number of threads: 4
Initializing random number generator from current time


Running memory speed test with the following options:
  block size: 1KiB
  total size: 102400MiB
  operation: write
  scope: global

Initializing worker threads...

Threads started!

Total operations: 31607059 (1580216.42 per second)

30866.27 MiB transferred (1543.18 MiB/sec)


General statistics:
    total time:                          20.0001s
    total number of events:              31607059

Latency (ms):
         min:                                  0.00
         avg:                                  0.00
         max:                                 32.92
         95th percentile:                      0.00
         sum:                              61558.88

Threads fairness:
    events (avg/stddev):           7901764.7500/200215.67
    execution time (avg/stddev):   15.3897/0.18

[root@izm5ead1jbc6fuk9xb9j4nz ~]# fio --directory=/mnt/vdb1 --name fio_test_file --rw=randrw --direct=1 --bs=4k --size=1G --numjobs=16 --time_based --runtime=60 --group_reporting
fio_test_file: (g=0): rw=randrw, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=psync, iodepth=1
...
fio-3.1
Starting 16 processes
Jobs: 16 (f=16): [m(16)][100.0%][r=9624KiB/s,w=9736KiB/s][r=2406,w=2434 IOPS][eta 00m:00s]
fio_test_file: (groupid=0, jobs=16): err= 0: pid=12262: Tue Nov  6 23:24:37 2018
   read: IOPS=2414, BW=9658KiB/s (9890kB/s)(566MiB/60009msec)
    clat (usec): min=412, max=99397, avg=2847.08, stdev=10808.04
     lat (usec): min=412, max=99398, avg=2847.53, stdev=10808.04
    clat percentiles (usec):
     |  1.00th=[  490],  5.00th=[  523], 10.00th=[  545], 20.00th=[  570],
     | 30.00th=[  603], 40.00th=[  627], 50.00th=[  652], 60.00th=[  685],
     | 70.00th=[  734], 80.00th=[  807], 90.00th=[ 1188], 95.00th=[ 4817],
     | 99.00th=[65799], 99.50th=[68682], 99.90th=[72877], 99.95th=[73925],
     | 99.99th=[80217]
   bw (  KiB/s): min=  208, max= 1008, per=6.26%, avg=604.29, stdev=126.68, samples=1920
   iops        : min=   52, max=  252, avg=150.93, stdev=31.62, samples=1920
  write: IOPS=2424, BW=9698KiB/s (9931kB/s)(568MiB/60009msec)
    clat (usec): min=393, max=115470, avg=3757.42, stdev=11650.86
     lat (usec): min=393, max=115471, avg=3757.97, stdev=11650.86
    clat percentiles (usec):
     |  1.00th=[  457],  5.00th=[  494], 10.00th=[  523], 20.00th=[  570],
     | 30.00th=[  603], 40.00th=[  644], 50.00th=[  693], 60.00th=[  750],
     | 70.00th=[  865], 80.00th=[ 1450], 90.00th=[ 5538], 95.00th=[15270],
     | 99.00th=[67634], 99.50th=[69731], 99.90th=[76022], 99.95th=[81265],
     | 99.99th=[94897]
   bw (  KiB/s): min=  224, max= 1042, per=6.26%, avg=606.77, stdev=119.05, samples=1920
   iops        : min=   56, max=  260, avg=151.55, stdev=29.71, samples=1920
  lat (usec)   : 500=3.92%, 750=62.67%, 1000=14.88%
  lat (msec)   : 2=6.93%, 4=3.37%, 10=2.76%, 20=1.71%, 50=0.76%
  lat (msec)   : 100=2.99%, 250=0.01%
  cpu          : usr=0.14%, sys=0.36%, ctx=290522, majf=0, minf=504
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwt: total=144899,145496,0, short=0,0,0, dropped=0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
   READ: bw=9658KiB/s (9890kB/s), 9658KiB/s-9658KiB/s (9890kB/s-9890kB/s), io=566MiB (594MB), run=60009-60009msec
  WRITE: bw=9698KiB/s (9931kB/s), 9698KiB/s-9698KiB/s (9931kB/s-9931kB/s), io=568MiB (596MB), run=60009-60009msec

Disk stats (read/write):
  vdb: ios=144638/145278, merge=0/22, ticks=409663/543240, in_queue=954241, util=99.87%

[root@izm5ead1jbc6fuk9xb9j4nz Geekbench-4.3.0-Linux]# ./geekbench4 
Geekbench 4.3.0 Tryout : http://www.geekbench.com/

Geekbench 4 is in tryout mode.

Geekbench 4 requires an active Internet connection when in tryout mode, and 
automatically uploads test results to the Geekbench Browser. Other features 
are unavailable in tryout mode.

Buy a Geekbench 4 license to enable offline use and remove the limitations of 
tryout mode.

If you would like to purchase Geekbench you can do so online:

  https://store.primatelabs.com/v4

If you have already purchased Geekbench, enter your email address and license 
key from your email receipt with the following command line:

  ./geekbench4 -r <email address> <license key>

  Running Gathering system information
System Information
  Operating System              Linux 3.10.0-693.2.2.el7.x86_64 x86_64
  Model                         Alibaba Cloud Alibaba Cloud ECS
  Motherboard                   N/A
  Memory                        7.64 GB 
  BIOS                          SeaBIOS rel-1.7.5-0-ge51488c-20140602_164612-nilsson.home.kraxel.org

Processor Information
  Name                          Intel(R) Xeon(R) Platinum 8163 CPU @ 2.50GHz
  Topology                      1 Processor, 1 Core, 2 Threads
  Identifier                    GenuineIntel Family 6 Model 85 Stepping 4
  Base Frequency                2.50 GHz
  L1 Instruction Cache          32.0 KB
  L1 Data Cache                 32.0 KB
  L2 Cache                      1.00 MB
  L3 Cache                      33.0 MB


Single-Core
  Running AES
  Running LZMA
  Running JPEG
  Running Canny
  Running Lua
  Running Dijkstra
  Running SQLite
  Running HTML5 Parse
  Running HTML5 DOM
  Running Histogram Equalization
  Running PDF Rendering
  Running LLVM
  Running Camera
  Running SGEMM
  Running SFFT
  Running N-Body Physics
  Running Ray Tracing
  Running Rigid Body Physics
  Running HDR
  Running Gaussian Blur
  Running Speech Recognition
  Running Face Detection
  Running Memory Copy
  Running Memory Latency
  Running Memory Bandwidth

Multi-Core
  Running AES
  Running LZMA
  Running JPEG
  Running Canny
  Running Lua
  Running Dijkstra
  Running SQLite
  Running HTML5 Parse
  Running HTML5 DOM
  Running Histogram Equalization
  Running PDF Rendering
  Running LLVM
  Running Camera
  Running SGEMM
  Running SFFT
  Running N-Body Physics
  Running Ray Tracing
  Running Rigid Body Physics
  Running HDR
  Running Gaussian Blur
  Running Speech Recognition
  Running Face Detection
  Running Memory Copy
  Running Memory Latency
  Running Memory Bandwidth


Uploading results to the Geekbench Browser. This could take a minute or two 
depending on the speed of your internet connection.

Upload succeeded. Visit the following link and view your results online:

  https://browser.geekbench.com/v4/cpu/10669916

Visit the following link and add this result to your profile:

  https://browser.geekbench.com/v4/cpu/10669916/claim?key=205516

  [root@izm5ead1jbc6fuk9xb9j4nz Geekbench-4.3.0-Linux]# sysbench /usr/share/sysbench/oltp_read_write.lua run --tables=20 --table_size=1000000 --db-driver=mysql --mysql-password=Passw0rd@123 --mysql-host=localhost --threads=400 --time=100
sysbench 1.0.9 (using system LuaJIT 2.0.4)

Running the test with following options:
Number of threads: 400
Initializing random number generator from current time


Initializing worker threads...

Threads started!

SQL statistics:
    queries performed:
        read:                            116564
        write:                           33298
        other:                           16650
        total:                           166512
    transactions:                        8324   (81.37 per sec.)
    queries:                             166512 (1627.63 per sec.)
    ignored errors:                      2      (0.02 per sec.)
    reconnects:                          0      (0.00 per sec.)

General statistics:
    total time:                          102.3015s
    total number of events:              8324

Latency (ms):
         min:                                  5.92
         avg:                               4870.93
         max:                              44979.31
         95th percentile:                  15371.13
         sum:                            40545657.10

Threads fairness:
    events (avg/stddev):           20.8100/4.37
    execution time (avg/stddev):   101.3641/0.62
```
